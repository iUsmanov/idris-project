## Тесты

В проекте используются 4 вида тестов:

1. Обычные unit тесты на jest
2. Тесты на компоненты с React testing library
3. Скриншотное тестирование с loki
4. e2e тестирование с Cypress - E2E пока не работает!!!

О том, как запускать те или иные тесты смотрите в разделе [Скрипты](docs/scripts.md)

Для тестирования используются следующие технологии:

-  Jest - юнит-тестирование и интеграционное тестирование
-  Loki - снимает скриншоты со стори-кейсов (Loki нуждается также в `Storybook`)
-  Cypress - E2E-тесты. E2E пока не работает!!!

### Jest

C использование `jest` написаны тесты на React-компоненты, роутинг, всякие хелперы и т.д.

-  Конфигурация Jest вот [здесь](/config/jest/jest.config.ts)
-  Вспомогательный файл - [setupTests.ts](/config/jest/setupTests.ts)
-  React-компонент, которым будут заменяться SVG-изображения в тестах -
   [setupTests.ts](/config/jest/jestEmptyComponent.tsx)

Двумя важными хелперами для тестирования являются [componentRender.tsx](/src/shared/lib/tests/componentRender/README.md)
и [TestAsyncThunk.ts](/src/shared/lib/tests/TestAsyncThunk/README.md)

Jest-тесты можно прогнать скриптом `npm run test:unit`. Если у нас тесты упали,
то автоматически в папке [/reports/jest](/reports/jest/report.html) сформируется подробный отчёт, который мы сможем открыть
и посмотреть подробно, почему тесты провалились.

---

---

### Скриншотное тестирование

С использование [Loki](https://loki.js.org/) происходит скриншотное тестирование.

Мы можем запустить скриншотное тестирование либо в dev-режиме, либо в prod-режиме.

В dev-режиме скриншотное тестирование обычно запускается локально.
При запуске скриншотного тестирования в dev-режиме делаем следующее:

1. Запускаем сторибук в dev-режиме - скрипт `npm run storybook`.
2. Запускаем Loki - скрипт `npm run test:ui`

---

В prod-режиме скриншотное тестирование обычно запускается удалённо.
При запуске скриншотного тестирования в prod-режиме делаем следующее:

1. Запускаем сторибук в prod-режиме - скрипт `npm run storybook:build`.
2. Запускаем Loki - скрипт `npm run test:ui:ci`

---

Затем тестирование закончится. Если тестирование не выявило несовпадений между предыдущим
запуском UI-тестов и нынешним, то всё ок.

Если же есть разница, то мы запускаем [скрипт](/scripts/generate-visual-json-report.js)
командой `npm run test:ui:report`. Затем у нас сгенерируется репорт в [этой](/reports/) или в [этой](/.loki) папке.
Открываем репорт и смотрим на разницу. Если нас не устраивают изменения - то тогда смотрим, где мы
напортачили, исправляем и снова запускаем тестирование. Если же нас всё устраивает, то тогда
применяем изменения запуском скрипта - `npm run test:ui:ok`.

Скрипт `npm run test:ui:update` используется после самого первого прогона ui-тестов.
Также напоминаю, что все скрипты описаны [здесь](/docs/scripts.md).
